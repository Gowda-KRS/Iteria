define(["knockout","pubsub","navigation","viewModels/address","notifier","ccConstants","CCi18n","spinner","ccRestClient"],function(e,t,n,r,i,s,o,u,a){"use strict";var f;return{WIDGET_ID:"addressBook",addressExisted:e.observable(!1),allAddressesCheck:e.observableArray([]),ignoreBlur:e.observable(!1),allfieldserror:e.observable(!1),allfieldserror1:e.observable(!1),currentEdit:e.observable(""),addressLine2Part1:e.observable(""),addressLine2Part2:e.observable(""),isUserProfileShippingEdited:e.observable(!1),isUserProfileDefaultAddressEdited:e.observable(!1),isUserProfileBillingEdited:e.observable(!1),interceptedLink:e.observable(null),isUserProfileInvalid:e.observable(!1),isProfileLocaleNotInSupportedLocales:e.observable(),companyName:e.observable(),firstName:e.observable(),lastName:e.observable(),fullName:e.observable(),address1:e.observable(),alias:e.observable(),address2:e.observable(),address3:e.observable(),errormessage:e.observable(),addressvalidationMessage:e.observable(),city:e.observable(),addressValidationRequest:e.observable(),addressValidationRequest1:e.observable(),state:e.observable(),postalCode:e.observable(),country:e.observable(),addressStatus:e.observable(),addressArray:e.observableArray([]),ContactList:e.observableArray([]),customDefaultBillingAddress:e.observable(),stateArray:e.observableArray([]),addressTypeArray:e.observableArray([]),type:e.observable(),selectedState:e.observable(),validAddresses:e.observableArray([]),beforeAppear:function(e){var r=this;r.addressExisted.subscribe(function(e){e?$("#CC-companyAddressAlreadyRegistered-Modal").show():$("#CC-companyAddressAlreadyRegistered-Modal").hide()}),$.Topic(t.topicNames.DISCARD_ADDRESS_CHANGES).subscribe(r.handleCancelUpdateForAddressBook),r.user().loggedIn()==0?n.doLogin(n.getPath(),r.links().home.route):r.user().isSessionExpiredDuringSave()?r.user().isSessionExpiredDuringSave(!1):(r.user().resetPassword(),r.showViewProfile(!0),i.clearError(r.WIDGET_ID),i.clearSuccess(r.WIDGET_ID),r.user().isUserProfileEdited(!1))},onLoad:function(o){var u=this;f=o;var a=e.observable(!1),l=e.observable(null),c=e.observable(!1);o.ContactList().push({name:o.user().firstName()+"  "+o.user().lastName(),id:o.user().id()}),o.fullName=e.pureComputed(function(){return o.user().firstName()+" "+o.user().lastName()},o),o.ErrorMsg=o.translate("updateErrorMsg"),o.passwordErrorMsg=o.translate("passwordUpdateErrorMsg"),u.addressArray.push("","Suite","Apartment","Building","P.O. Box"),u.addressTypeArray.push("","Business","Residential");if(o.user().parentOrganization===null){var h=0;for(h=0;h<o.user().dynamicProperties().length;h++)if(o.user().dynamicProperties()[h].id()=="default_billingAddress_data"){o.customDefaultBillingAddress(o.user().dynamicProperties()[h].value());if(o.user().dynamicProperties()[h].value()!=null){var p=o.user().dynamicProperties()[h].value().replaceAll("=",":").replaceAll(" ",""),d=["companyName","address1","address2","address3","city","state","postalCode","country","firstName","lastName","alias"];for(var v=0;v<d.length;v++)if(d[v]=="companyName")o.companyName(o.billingAddressParse(p,d[v]));else if(d[v]=="firstName")o.firstName(o.billingAddressParse(p,d[v]));else if(d[v]=="lastName")o.lastName(o.billingAddressParse(p,d[v]));else if(d[v]=="address1")o.address1(o.billingAddressParse(p,d[v]));else if(d[v]=="address2"){o.address2(o.billingAddressParse(p,d[v]));var m=o.billingAddressParse(p,d[v]);[null,undefined,""].indexOf(m)==-1?m.toLowerCase().indexOf("suite")!==-1?(o.addressLine2Part1(m.substring(0,5)),o.addressLine2Part2(m.substring(5,m.length))):m.toLowerCase().indexOf("apartment")!==-1?(o.addressLine2Part1(m.substring(0,9)),o.addressLine2Part2(m.substring(9,m.length))):m.toLowerCase().indexOf("building")!==-1?(o.addressLine2Part1(m.substring(0,8)),o.addressLine2Part2(m.substring(8,m.length))):m.toLowerCase().indexOf("p.o.")!==-1?(o.addressLine2Part1(m.substring(0,8)),o.addressLine2Part2(m.substring(8,m.length))):(o.addressLine2Part1(""),o.addressLine2Part2(m)):(o.addressLine2Part1(""),o.addressLine2Part2(""))}else d[v]=="address3"?o.address3(o.billingAddressParse(p,d[v])):d[v]=="city"?o.city(o.billingAddressParse(p,d[v])):d[v]=="state"?o.state(o.billingAddressParse(p,d[v])):d[v]=="postalCode"?o.postalCode(o.billingAddressParse(p,d[v])):d[v]=="alias"?o.alias(o.billingAddressParse(p,d[v])):d[v]=="country"&&o.country(o.billingAddressParse(p,d[v]))}}}o.showViewProfile=function(e){e&&o.user().getCurrentUser(!1),o.isUserProfileShippingEdited(!1),o.isUserProfileDefaultAddressEdited(!1)},o.reloadShipping=function(){if(o.user().updatedShippingAddressBook){var e=[];for(var t=0;t<o.user().updatedShippingAddressBook.length;t++){var n=new r("user-shipping-address",o.ErrorMsg,o,o.shippingCountries(),o.defaultShippingCountry());n.countriesList(o.shippingCountries()),n.copyFrom(o.user().updatedShippingAddressBook[t],o.shippingCountries()),n.resetModified(),n.country(o.user().updatedShippingAddressBook[t].countryName),n.state(o.user().updatedShippingAddressBook[t].regionName),e.push(n)}for(var i=0;i<e.length;i++)e[i].isDefaultAddress();if(e.length>0){o.allAddressesCheck([]);for(var s=0;s<e.length;s++)o.allAddressesCheck().push({address1:e[s].address1(),address2:e[s].address2(),city:e[s].city(),state:e[s].selectedState(),postalCode:e[s].postalCode(),country:e[s].selectedCountry()})}o.user().shippingAddressBook(e)}},o.handleMouseUp=function(){return this.ignoreBlur(!1),!0},o.handleMouseDown=function(){return this.ignoreBlur(!0),!0},o.hideModal=function(){if(a()||o.user().isSearchInitiatedWithUnsavedChanges())$("#CC-customerProfile-modal-3").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()},o.showModal=function(){$("#CC-customerProfile-modal-3").modal("show"),a(!0)},o.handleCancelUpdateForAddressBook=function(){o.showViewProfile(!0),o.user().editShippingAddress(null),o.reloadShipping(),i.clearError(o.WIDGET_ID),i.clearSuccess(o.WIDGET_ID),o.user().isUserProfileEdited(!1),o.hideModal()},o.handleModalCancelUpdateDiscard=function(){o.handleCancelUpdateForAddressBook(),o.user().isSearchInitiatedWithUnsavedChanges()?(o.hideModal(),o.user().isSearchInitiatedWithUnsavedChanges(!1)):o.navigateAway()},o.handleCreateShippingAddress=function(){o.addressLine2Part1(""),o.addressLine2Part2("");var e=new r("user-shipping-address",o.ErrorMsg,o,o.shippingCountries(),o.defaultShippingCountry());o.currentEdit("new"),o.editShippingAddress(e)},o.editShippingAddress=function(e){if(o.currentEdit()=="new"){o.currentEdit("new");var t={address1:"",address2:" ",city:"",state:"",postalCode:"",country:""};f.addressValidationRequest1(t)}else{o.currentEdit("ship"),e.address2().toLowerCase().indexOf("suite")!==-1?(o.addressLine2Part1(e.address2().substring(0,5)),o.addressLine2Part2(e.address2().substring(6,e.address2().length))):e.address2().toLowerCase().indexOf("apartment")!==-1?(o.addressLine2Part1(e.address2().substring(0,9)),o.addressLine2Part2(e.address2().substring(10,e.address2().length))):e.address2().toLowerCase().indexOf("building")!==-1?(o.addressLine2Part1(e.address2().substring(0,8)),o.addressLine2Part2(e.address2().substring(9,e.address2().length))):e.address2().toLowerCase().indexOf("p.o.")!==-1?(o.addressLine2Part1(e.address2().substring(0,8)),o.addressLine2Part2(e.address2().substring(9,e.address2().length))):(o.addressLine2Part1(""),o.addressLine2Part2(e.address2()));var t={address1:e.address1(),address2:f.addressLine2Part1()+" "+f.addressLine2Part2(),city:e.city(),state:e.state(),postalCode:e.postalCode(),country:e.country()};f.addressValidationRequest1(t)}o.user().isUserProfileEdited(!0),i.clearError(o.WIDGET_ID),i.clearSuccess(o.WIDGET_ID),e.country("US"),o.user().editShippingAddress(e),o.isUserProfileShippingEdited(!0),o.isUserProfileBillingEdited(!1),document.body.scrollTop=0,document.documentElement.scrollTop=0,$("#CC-customerProfile-sfirstname").focus(),o.shippingCountries().length==0&&$("#CC-customerProfile-shippingAddress-edit-region input").attr("disabled",!0)},o.editBillingAddress1=function(e){o.currentEdit("bill"),o.user().isUserProfileEdited(!0),i.clearError(o.WIDGET_ID),i.clearSuccess(o.WIDGET_ID),o.user().editShippingAddress(e),o.isUserProfileShippingEdited(!0),o.isUserProfileBillingEdited(!1),$("#CC-customerProfile-sfirstname").focus(),o.shippingCountries().length==0&&$("#CC-customerProfile-shippingAddress-edit-region input").attr("disabled",!0)},o.handleSelectDefaultShippingAddress=function(e){o.selectDefaultShippingAddress(e),e.country("US"),e.isDefaultShippingAddress(!0),o.user().editShippingAddress(e),o.createNewProfileAddress1(o.convertToData(),o.user().editShippingAddress().repositoryId),o.isUserProfileDefaultAddressEdited(!0)},o.handleRemoveShippingAddress=function(e){o.user().shippingAddressBook.remove(e),o.user().deleteShippingAddress(!0),e.isDefaultAddress()&&o.user().shippingAddressBook().length>0&&o.selectDefaultShippingAddress(o.user().shippingAddressBook()[0]),o.user().shippingAddressBook().length===0&&$.Topic(t.topicNames.USER_PROFILE_ADDRESSES_REMOVED).publish(),o.handleUpdateProfileForAddressBook()},o.selectDefaultShippingAddress=function(e){o.user().selectDefaultAddress(e)},o.handleUpdateProfileForAddressBook=function(){if([null,undefined,""].indexOf(o.user().editShippingAddress().x_account_type())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().address1())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().city())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().selectedState())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().postalCode())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().country())==-1){for(var e=0;e<o.user().shippingAddressBook().length;e++)o.user().shippingAddressBook()[e].repositoryId==o.user().editShippingAddress().repositoryId&&(o.user().shippingAddressBook()[e].address2(o.addressLine2Part1()+" "+o.addressLine2Part2()),o.user().shippingAddressBook()[e].country("US"));o.createNewProfileAddress1(o.convertToData(),o.user().editShippingAddress().repositoryId),o.currentEdit("")}else o.allfieldserror(!0)},o.handleUpdateProfileForAddressBookNew=function(){if([null,undefined,""].indexOf(o.user().editShippingAddress().x_account_type())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().address1())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().city())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().state())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().postalCode())==-1&&[null,undefined,""].indexOf(o.user().editShippingAddress().country())==-1){var e="";for(var t=0;t<o.user().dynamicProperties().length;t++)o.user().dynamicProperties()[t].id()=="home_phone_number"&&(e=o.user().dynamicProperties()[t].value());var n={addressType:"Address"+o.user().shippingAddresses().length,address:{address1:o.user().editShippingAddress().address1(),address2:o.user().editShippingAddress().address2(),address3:o.user().editShippingAddress().address3(),county:"IL",country:o.user().editShippingAddress().country(),state:o.user().editShippingAddress().state(),firstName:o.user().editShippingAddress().firstName(),lastName:o.user().lastName(),companyName:o.user().editShippingAddress().alias(),city:o.user().editShippingAddress().city(),postalCode:o.user().editShippingAddress().postCode,phoneNumber:e}};o.createNewProfileAddress(o.convertToData())}else o.allfieldserror(!0)},o.handleModalUpdateProfile=function(){c(!0);if(o.user().isSearchInitiatedWithUnsavedChanges()){o.handleUpdateProfileForAddressBook(),o.hideModal(),o.user().isSearchInitiatedWithUnsavedChanges(!1);return}l!="CC-loginHeader-myAccount"&&o.user().delaySuccessNotification(!0),o.handleUpdateProfileForAddressBook()},$.Topic(t.topicNames.USER_PROFILE_UPDATE_NOCHANGE).subscribe(function(){o.showViewProfile(!1),o.hideModal()}),$.Topic(t.topicNames.USER_PROFILE_SESSION_RESET).subscribe(function(){o.showViewProfile(!1),o.hideModal()}),$.Topic(t.topicNames.USER_PROFILE_UPDATE_INVALID).subscribe(function(){$("#Error-Modal").modal("show"),c()&&(o.isUserProfileInvalid(!0),c(!1)),o.user().delaySuccessNotification(!1),o.hideModal()}),$.Topic(t.topicNames.USER_PROFILE_UPDATE_SUCCESSFUL).subscribe(function(){o.user().isUserProfileEdited(!1),o.showViewProfile(!0),i.clearError(o.WIDGET_ID),i.clearSuccess(o.WIDGET_ID),o.user().delaySuccessNotification()||$("#Save-Modal").modal("show"),o.hideModal(),c()&&(c(!1),o.navigateAway())}),$.Topic(t.topicNames.USER_PROFILE_UPDATE_FAILURE).subscribe(function(e){c()&&(o.isUserProfileInvalid(!0),c(!1)),o.user().delaySuccessNotification(!1),o.hideModal();if(e.status==s.HTTP_UNAUTHORIZED_ERROR)o.user().isSessionExpiredDuringSave(!0),n.doLogin(n.getPath());else{var t=o.passwordErrorMsg;i.clearError(o.WIDGET_ID),i.clearSuccess(o.WIDGET_ID),e.errorCode===s.USER_PROFILE_INTERNAL_ERROR?(t=e.message,o.user().getCurrentUser(!1),o.reloadShipping()):e.errors&&e.errors.length>0&&e.errors[0].errorCode===s.USER_PROFILE_SHIPPING_UPDATE_ERROR?t=e.errors[0].message:t=e.message,$("#Error-Modal").modal("show"),f.errormessage(t),o.hideModal()}}),$.Topic(t.topicNames.USER_LOAD_SHIPPING).subscribe(function(){o.reloadShipping()}),$.Topic(t.topicNames.UPDATE_USER_LOCALE_NOT_SUPPORTED_ERROR).subscribe(function(){o.isProfileLocaleNotInSupportedLocales(!0)}),o.navigateAway=function(){if(l==="CC-header-checkout"||l==="CC-loginHeader-logout"||l==="CC-customerAccount-view-orders"||l==="CC-header-language-link"||l.indexOf("CC-header-languagePicker")!=-1){o.removeEventHandlersForAnchorClick(),o.showViewProfile(!1);var e=$("#"+l).get()[0];e.click()}else if(l==="CC-loginHeader-myAccount"){var e=$("#"+l).get()[0];e.click()}else n.isPathEqualTo(o.interceptedLink)||(n.goTo(o.interceptedLink),o.removeEventHandlersForAnchorClick())};var g=function(e,t){var n=t&&t.usingCCLink;o.isProfileLocaleNotInSupportedLocales(!1);if(o.user().loggedIn()){l=this.id,o.interceptedLink=e.currentTarget.pathname;if(o.isUserProfileShippingEdited()||o.isUserProfileDefaultAddressEdited())return o.showModal(),n&&(t.preventDefault=!0),!1;o.showViewProfile(!1)}},y=function(e){o.isProfileLocaleNotInSupportedLocales(!1)};o.addEventHandlersForAnchorClick=function(){$("body").on("click.cc.unsaved","a",g),$("body").on("mouseleave",y)},o.removeEventHandlersForAnchorClick=function(){$("body").off("click.cc.unsaved","a",g)}},createNewProfileAddress:function(e){var t=this;a.profileType===s.PROFILE_TYPE_AGENT?a.request(s.END_POINT_ADD_PROFILE_ADDRESS,e,t.profileCreateOrUpdateSuccess.bind(t),t.profileAddressSaveFailure.bind(t),t.user().id()):a.request(s.END_POINT_ADD_PROFILE_ADDRESS,e,t.profileCreateOrUpdateSuccess.bind(t),t.profileAddressSaveFailure.bind(t))},createNewProfileAddress1:function(e,t){var n=this;a.request(s.END_POINT_UPDATE_PROFILE_ADDRESS,e,n.profileCreateOrUpdateSuccess.bind(n),n.profileAddressSaveFailure.bind(n),t)},convertToData:function(e){var t=this,n={};t.user().editShippingAddress().alias()?n[s.ORG_ADDRESS_TYPE]=t.user().editShippingAddress().alias():n[s.ORG_ADDRESS_TYPE]="Address"+t.user().shippingAddresses().length;var r={};return r.Address_Status=t.user().editShippingAddress().Address_Status(),r[s.ORG_ADDRESS_1]=t.user().editShippingAddress().address1(),t.addressLine2Part2()||t.addressLine2Part1()?r[s.ORG_ADDRESS_2]=t.addressLine2Part1()+" "+t.addressLine2Part2():r[s.ORG_ADDRESS_2]="",r.x_account_type=t.user().editShippingAddress().x_account_type(),t.user().editShippingAddress().address3()===null||t.user().editShippingAddress().address3()===undefined||t.user().editShippingAddress().address3()===""?r[s.ORG_ADDRESS_3]="":r[s.ORG_ADDRESS_3]=t.user().editShippingAddress().address3(),t.user().editShippingAddress().county()===null||t.user().editShippingAddress().county()===undefined||t.user().editShippingAddress().county()===""?r[s.ORG_COUNTY]="":r[s.ORG_COUNTY]=t.user().editShippingAddress().county(),r[s.ORG_COUNTRY]="US",[null,undefined,""].indexOf(t.user().editShippingAddress().state())!=-1?r[s.ORG_STATE]="":r[s.ORG_STATE]=t.user().editShippingAddress().state(),t.currentEdit()=="new"?r.state=t.user().editShippingAddress().state():r.state=t.user().editShippingAddress().selectedState(),t.user().editShippingAddress().state(),t.user().editShippingAddress().firstName()===null||t.user().editShippingAddress().firstName()===undefined||t.user().editShippingAddress().firstName()===""?r[s.PROFILE_FIRST_NAME]="":r[s.PROFILE_FIRST_NAME]=t.user().editShippingAddress().firstName(),t.user().editShippingAddress().lastName()===null||t.user().editShippingAddress().lastName()===undefined||t.user().editShippingAddress().lastName()===""?r[s.PROFILE_LAST_NAME]="":r[s.PROFILE_LAST_NAME]=t.user().editShippingAddress().lastName(),t.user().editShippingAddress().companyName()===null||t.user().editShippingAddress().companyName()===undefined||t.user().editShippingAddress().companyName()===""?r[s.ORG_COMPANY_NAME]="":r[s.ORG_COMPANY_NAME]=t.user().editShippingAddress().companyName(),r[s.ORG_CITY]=t.user().editShippingAddress().city(),r[s.ORG_POSTAL_CODE]=t.user().editShippingAddress().postalCode(),t.user().editShippingAddress().phoneNumber()===null||t.user().editShippingAddress().phoneNumber()===undefined||t.user().editShippingAddress().phoneNumber()===""?r[s.ORG_PHONE_NUMBER]="":r[s.ORG_PHONE_NUMBER]=t.user().editShippingAddress().phoneNumber(),r.special_delivery_instructions=t.user().editShippingAddress().special_delivery_instructions(),r.selectedCountry=t.user().editShippingAddress().selectedCountry(),r[s.ORG_IS_DEFAULT_BILLING_ADDRESS]=t.user().editShippingAddress().isDefaultBillingAddress(),r[s.ORG_IS_DEFAULT_SHIPPING_ADDRESS]=t.user().editShippingAddress().isDefaultShippingAddress(),r[s.ORG_IS_DEFAULT_SHIPPING_ADDRESS]=!1,r.isDefaultShippingAddress=t.user().editShippingAddress().isDefaultShippingAddress(),n[s.ORG_ADDRESS]=r,n},editBillingAddress:function(){f.isUserProfileBillingEdited(!0),$("#edit-billing-address").show(),$("#b2cAddresses").hide()},billingAddressParse:function(e,t){e.indexOf(t),e.indexOf(":",e.indexOf(t));var n;return e.indexOf(",",e.indexOf(t))==-1?n=e.indexOf("}",e.indexOf(t)):n=e.indexOf(",",e.indexOf(t)),e.substring(e.indexOf(":",e.indexOf(t))+1,n)},billingAddressMerge:function(e,t){var n;return e.indexOf(",",e.indexOf(t))==-1?n=e.indexOf("}",e.indexOf(t)):n=e.indexOf(",",e.indexOf(t)),e.substring(e.indexOf(":",e.indexOf(t))+1,n)},backToMyaccount:function(){n.goTo("/myaccount")},validateAddress1:function(e,t,n){if(t!==undefined&&t.keyCode==9){var r={parent:"#main",posTop:"20em",posLeft:"50%"};$("#main").addClass("loadingIndicator"),$("#main").css("position","relative"),u.create(r);var i=!1;if([null,undefined,""].indexOf(n.address1())==-1&&[null,undefined,""].indexOf(n.city())==-1&&[null,undefined,""].indexOf(n.postalCode())==-1&&[null,undefined,""].indexOf(n.country())==-1&&[null,undefined,""].indexOf(n.state())==-1){if(f.currentEdit()=="new"){var s={address1:n.address1(),address2:f.addressLine2Part1()+" "+f.addressLine2Part2(),city:n.city(),state:n.state(),postalCode:n.postalCode(),country:n.country()},o=f.addressExisted();for(var a=0;a<f.allAddressesCheck().length;a++){if(JSON.stringify(f.allAddressesCheck()[a]).toLowerCase().replaceAll(" ","")===JSON.stringify(s).toLowerCase().replaceAll(" ","")){o=!0,$("#CC-addressSuggestionMessagePane1").hide(),$("#main").removeClass("loadingIndicator"),u.destroy();break}o=!1}f.addressExisted()!==o&&f.addressExisted(o)}if(!f.addressExisted()){var l={};l={address1:n.address1(),address2:f.addressLine2Part1()+" "+f.addressLine2Part2(),city:n.city(),state:n.state(),postalCode:n.postalCode(),country:n.country()};var c={url:"/ccstorex/custom/v1/addressValidation",method:"POST",data:JSON.stringify(l),async:!1,contentType:"application/json"},h=!1;return JSON.stringify(f.addressValidationRequest1())!==JSON.stringify(l)?h=!0:($("#main").removeClass("loadingIndicator"),u.destroy()),h?(f.addressValidationRequest1(l),$.ajax(c).done(function(e){$("#main").removeClass("loadingIndicator"),u.destroy(),console.log("Response :: ",e),e&&e.validatedAddresses&&(console.log("Under valid ADDRESS"),e.hasOwnProperty("messages")?(f.addressvalidationMessage(e.messages[0].summary),f.validAddresses([]),$("#CC-addressSuggestionMessagePane1").show()):e.validatedAddresses.length>0&&(console.log("Under valid ADDRESS LENGTH"),f.addressvalidationMessage(""),f.validAddresses(e.validatedAddresses),$("#CC-addressSuggestionMessagePane1").show()))})):console.log("already have"),!0}$("#main").removeClass("loadingIndicator"),u.destroy()}else $("#main").removeClass("loadingIndicator"),u.destroy()}return!0},validateAddress:function(e,t){if(t!==undefined&&t.keyCode==9){var n={parent:"#main",posTop:"20em",posLeft:"50%"};$("#main").addClass("loadingIndicator"),$("#main").css("position","relative"),u.create(n);var r=!1;if([null,undefined,""].indexOf(f.address1())==-1&&[null,undefined,""].indexOf(f.city())==-1&&[null,undefined,""].indexOf(f.postalCode())==-1&&[null,undefined,""].indexOf(f.country())==-1&&[null,undefined,""].indexOf(f.state())==-1){var i={};i={address1:f.address1(),address2:f.address3()+" "+f.address2(),city:f.city(),state:f.state(),postalCode:f.postalCode(),country:f.country()};var s={url:"/ccstorex/custom/v1/addressValidation",method:"POST",data:JSON.stringify(i),async:!1,contentType:"application/json"},o=!1;return JSON.stringify(f.addressValidationRequest())!==JSON.stringify(i)?o=!0:($("#main").removeClass("loadingIndicator"),u.destroy()),o?(f.addressValidationRequest(i),$.ajax(s).done(function(e){$("#main").removeClass("loadingIndicator"),u.destroy(),console.log("Response :: ",e),e&&e.validatedAddresses&&(console.log("Under valid ADDRESS"),e.hasOwnProperty("messages")?(f.addressvalidationMessage(e.messages[0].summary),f.validAddresses([]),$("#CC-addressSuggestionMessagePane").show()):e.validatedAddresses.length>0&&(console.log("Under valid ADDRESS LENGTH"),f.addressvalidationMessage(""),f.validAddresses(e.validatedAddresses),$("#CC-addressSuggestionMessagePane").show()))})):console.log("already have"),!0}$("#main").removeClass("loadingIndicator"),u.destroy()}return!0},closecompanyexistmodal:function(){return $("#CC-companyAlreadyRegistered-Modal").hide(),!0},closecompanyaddressexistmodal:function(){return $("#CC-companyAddressAlreadyRegistered-Modal").hide(),!0},closesuggesionmodal:function(){return $("#CC-addressSuggestionMessagePane").hide(),!0},closesuggesionmodal1:function(){return $("#CC-addressSuggestionMessagePane1").hide(),!0},setSelectedAddress:function(){return f.address1(f.validAddresses()[0].line1),f.city(f.validAddresses()[0].city),f.state(f.validAddresses()[0].region),f.postalCode(f.validAddresses()[0].postalCode),$("#CC-addressSuggestionMessagePane").hide(),!0},setSelectedAddress1:function(){f.user().editShippingAddress().address1(f.validAddresses()[0].line1),f.user().editShippingAddress().city(f.validAddresses()[0].city),f.user().editShippingAddress().state(f.validAddresses()[0].region),f.user().editShippingAddress().postalCode(f.validAddresses()[0].postalCode);if(f.currentEdit()=="new"){var e={address1:f.validAddresses()[0].line1,address2:f.addressLine2Part1()+" "+f.addressLine2Part2(),city:f.validAddresses()[0].city,state:f.validAddresses()[0].region,postalCode:f.validAddresses()[0].postalCode,country:"us"},t=f.addressExisted();for(var n=0;n<f.allAddressesCheck().length;n++){if(JSON.stringify(f.allAddressesCheck()[n]).toLowerCase()===JSON.stringify(e).toLowerCase()){t||f.addressExisted(!0);break}f.addressExisted(!1)}}return $("#CC-addressSuggestionMessagePane1").hide(),!0},updateBilling:function(e){console.log("updating the billing address");var t=this;if([null,undefined,""].indexOf(f.address1())===-1&&[null,undefined,""].indexOf(f.address1())===-1&&[null,undefined,""].indexOf(f.address1())===-1&&[null,undefined,""].indexOf(f.address1())===-1&&[null,undefined,""].indexOf(f.address1())===-1){for(var n=0;n<f.user().dynamicProperties().length;n++)if(f.user().dynamicProperties()[n].id()=="default_billingAddress_data"){var r=f.user().dynamicProperties()[n].value();r=r.substring(0,r.indexOf("companyName")+12)+f.companyName()+r.substring(r.indexOf(",",r.indexOf("companyName"))),r=r.substring(0,r.indexOf("alias")+6)+f.alias()+r.substring(r.indexOf(",",r.indexOf("alias"))),r=r.substring(0,r.indexOf("address1")+9)+f.address1()+r.substring(r.indexOf(",",r.indexOf("address1"))),r=r.substring(0,r.indexOf("address2")+9)+f.addressLine2Part1()+""+f.addressLine2Part2()+r.substring(r.indexOf(",",r.indexOf("address2"))),r=r.substring(0,r.indexOf("address3")+9)+f.address3()+r.substring(r.indexOf(",",r.indexOf("address3"))),r=r.substring(0,r.indexOf("city")+5)+f.city()+r.substring(r.indexOf(",",r.indexOf("city"))),r=r.substring(0,r.indexOf("state")+6)+f.state()+r.substring(r.indexOf(",",r.indexOf("state"))),r=r.substring(0,r.indexOf("postalCode")+11)+f.postalCode()+r.substring(r.indexOf(",",r.indexOf("postalCode"))),r=r.substring(0,r.indexOf("country")+8)+f.country()+r.substring(r.indexOf(",",r.indexOf("country"))),r=r.substring(0,r.indexOf("firstName")+10)+f.firstName()+r.substring(r.indexOf(",",r.indexOf("firstName"))),r=r.substring(0,r.indexOf("lastName")+9)+f.lastName()+r.substring(r.indexOf(",",r.indexOf("lastName"))),f.user().dynamicProperties()[n].value(r)}var i={default_billingAddress_data:r};a.request(s.ENDPOINT_UPDATE_PROFILE,i,t.profileCreateOrUpdateSuccess.bind(t),t.profileAddressSaveFailure.bind(t),f.user().id()),$("#edit-billing-address").hide(),$("#b2cAddresses").show()}else f.allfieldserror1(!0)},validatingData:function(e,t,n){var r=e,i;if("click"===t.type||"blur"===t.type||t.keyCode===9)t.target.value===""?(console.log("data is null"),t.target.style="border: 2px solid #f33",t.target.id!==null&&(i=t.target.id+"-label",document.getElementById(i).style="color:#f33")):(console.log("data is not null"),t.target.style="border: 2px solid #d3d3d",t.target.id!==null&&(i=t.target.id+"-label",document.getElementById(i).style="color:black"));return!0},profileAddressSaveFailure:function(e){var t=this;i.clearError(t.WIDGET_ID),i.clearSuccess(t.WIDGET_ID),e.status==s.HTTP_UNAUTHORIZED_ERROR?(t.user().handleSessionExpired(),(n.isPathEqualTo(t.links().profile.route)||n.isPathEqualTo(t.links().accountAddresses.route))&&n.doLogin(n.getPath(),t.homeRoute)):i.sendError(t.WIDGET_ID,e.message?e.message:this.translate("organizationAddressUpdateFailureText"),!0)},profileCreateOrUpdateSuccess:function(e){var t=this;t.user().isUserProfileEdited(!1),t.showViewProfile(!0),t.currentEdit(""),$("#Save-Modal").modal("show"),$("#edit-shipping-address").hide(),$("#b2cAddresses").show()},changestatus:function(e){f.user().shippingAddressBook()[e].Address_Status(!1),f.user().organizationAddressBook[e].Address_Status=!1,f.user().editShippingAddress(f.user().shippingAddressBook()[e]),f.createNewProfileAddress1(f.convertToData(),f.user().editShippingAddress().repositoryId)},closecompanyexistmodal:function(){return $("#CC-companyAlreadyRegistered-Modal").hide(),!0},closesuggesionmodal:function(){return $("#CC-addressSuggestionMessagePane").hide(),!0},updateShippingAddressContact:function(e,t,n){var r=this},changestatus1:function(e){f.user().shippingAddressBook()[e].Address_Status(!0),f.user().organizationAddressBook[e].Address_Status=!0,f.user().editShippingAddress(f.user().shippingAddressBook()[e]),f.createNewProfileAddress1(f.convertToData(),f.user().editShippingAddress().repositoryId)},backtomain:function(){f.isUserProfileShippingEdited(!1),$("#edit-billing-address").hide(),$("#b2cAddresses").show()}}})