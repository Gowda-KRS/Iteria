define(["storeKoExtensions","ccRestClient","notifications","knockout","CCi18n","ojs/ojcore","pubsub","agentViewModels/agentUtils/agent-utils","ojs/ojknockout","ojs/ojselectcombobox","bstypeahead"],function(e,t,n,r,i,s,o,u){"use strict";var a=undefined,f;return{elementName:"ultrasource-account-search-v1",accountSearchValue:r.observable(),MIN_CHARACTERS:3,MAX_RESULTS:100,onLoad:function(e){$.Topic(o.topicNames.SEARCH_RESET).subscribe(this.resetSearch.bind(this));var t=this;t.widget=e,f!=undefined&&f.dispose(),f=t.accountSearchValue.subscribe(function(){t.handleAccountSearchValueUpdate()}),t.accountSearchValue(""),t.handleAccountSearchValueUpdate(!0)},handleAccountSearchValueUpdate:function(e){typeof this.widget.handleAccountSearchValueUpdate=="function"&&this.widget.handleAccountSearchValueUpdate(this.accountSearchValue(),e)},resetSearch:function(e){var t=this;this.accountSearchValue(null)},initializer:function(e,t){var n=this.elements["ultrasource-account-search-v1"];a=n;var r="#"+e;$(r).typeahead({source:n.typeaheadSource,minLength:n.MIN_CHARACTERS,autoSelect:!0,items:n.MAX_RESULTS,matcher:n.typeaheadMatch,sorter:n.typeaheadSort,highlighter:n.typeaheadHighlight,render:n.typeaheadRender,select:n.typeaheadSelect,menu:"<ul class='typeahead dropdown-menu' aria-live='polite'></ul>",item:"<li><a href='#'>                             <span class = 'typeaheadAccountName'> </span>  <span class = 'typeaheadProductPrice'> </span>  </a></li>"})},typeaheadSource:function(e,n,r){this.render=this.options.render||this.render,this.$menu.css("margin-left",0),this.$menu.css("width","100%");var i=function(){a.callback=n,this.timer&&clearTimeout(this.timer),e=e.replace(/\\/g,"\\\\"),e=e.replace(/"/g,'\\"');var r={limit:10,offset:0,q:'( name co "'+e+'" )'};return new Promise(function(e,n){t.request("listOrganizations",r,a.listOrganizationSuccess.bind(a),a.listOrganizationFailure.bind(a))})}.bind(this);this.timer=setTimeout(i,300)},typeaheadRender:function(e){var t=this;if(e.length===1&&e[0].id==="NO MATCHES FOUND"){var n="No matches found";return this.$menu.html($("<li class='typeaheadTop' disabled>").text(n)),this}return e=$(e).map(function(e,n){return e=$(t.options.item).attr("data-value",n.name),e.find("a").attr("title",n.name),e.find("a").attr("id",n.id),e.find(".typeaheadAccountName").html(n.name),e[0]}),e.first().addClass("firstResult"),this.$menu.html(e),this},typeaheadMatch:function(e){return!0},typeaheadSort:function(e){return e},typeaheadHighlight:function(e){return e},typeaheadSelect:function(e){var t=this.$menu.find(".active"),n=t.children("a").attr("title");return a.accountSearchValue(n),this.hide()},listOrganizationSuccess:function(e){e.items.length||e.items.push({id:"NO MATCHES FOUND",name:"",price:"",thumb:"",link:""}),a.callback(e.items)},listOrganizationFailure:function(e){var t=this,n=i.t("ns.common:resources.accountSearchFailureText"),r=e.errorCode==="100070"?i.t("ns.common:resources.accountSearchErrorMessage"):e.message,s=e.errorCode;u.notifyErrorMessage(n,r,s)}}})