define(["knockout","spinner","CCi18n","agentViewModels/customer-search","jquery","ccConstants","ccRestClient","pubsub","agentViewModels/agentUtils/agent-utils","agentViewModels/agent-context-manager","viewModels/site-listing","agentViewModels/agentConfiguration","agentViewModels/account-site-selector","notifier","viewModels/shopperContext","navigation"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){"use strict";var m;return{sites:e.observableArray([]),customerSearchViewModel:new r,isCreateOrderEnabled:e.observable(!0),customerCartsViewModel:e.observable(),contextManager:f,profileOffset:e.observable(0),accountUniqueId:e.observable(""),accountUniqueIdArray:e.observableArray(),accountNumber:e.observable(),allAddresses:e.observableArray(),allDiscountPrnts:e.observableArray([]),totalProfileAddresses:e.observable(0),opDynamicProperty:e.observable(),inheritedAddresses:e.observableArray([]),secondaryAddresses:e.observableArray([]),profileAddresses:e.observableArray([]),addresses:e.observableArray([]),isEditMode:e.observable(!1),contextManager:f,offset:e.observable(0),countriesList:e.observableArray([]),profileOffset:e.observable(0),countriesList:e.observableArray([]),accountOffset:e.observable(0),accountNumberText:e.observable(),limit:e.observable(40),isCustomerCartsModalOpened:e.observable(!1),isCreditHoldArray:e.observableArray(),isSlowPayArray:e.observableArray(),spinnerOptions:{parent:"#page",posTop:"50%",posLeft:"50%"},lineOfBusiness:e.observableArray([]),onLoad:function(t){console.log("Entering - onLoad()"),m=t,m.getCurrentAdminProfile(),t.itemsPerPage?t.customerSearchViewModel.itemsPerPage=parseInt(t.itemsPerPage):t.customerSearchViewModel.itemsPerPage=15,t.initCustomerSearchCriteria(),f.getInstance().clearAgentContextHeader(),a.removeFromStorage(s.LOCAL_STORAGE_ORGANIZATION_ID),a.removeFromStorage(s.LOCAL_STORAGE_AGENT_CONTEXT),a.removeFromStorage(s.LOCAL_STORAGE_SITE_ID),e.bindingHandlers.enterkey={init:function(e,t,n,r){var s=t();i(e).keypress(function(e){var t=e.which?e.which:e.keyCode;return t===13?(console.log("enter was pressed"),s.call(r),!1):!0})}},t.isSearchEnabled=function(){return this.accountNumber()||this.businessName()||this.phoneNumber()||this.address1()||this.city()||this.state()||this.postalCode()?(console.log("Search Enabled"),!0):!1}},NavigatetoPage:function(e){var t=this;e=="Order_History"?v.goTo("/pos_findOrderHistory"):e=="Find_Customer"?v.goTo("/pos_findCustomer"):e=="Store_Cart"?v.goTo("/pos_findStoreCart"):e=="AddressBook"?v.goTo("/pos_findAddressBook"):e=="Find_Order"?v.goTo("/pos_findOrder"):e=="New_Order"&&v.goTo("/pos_findNewOrder")},loadProfileAddressSuccess:function(e){var t=this;if(e.items.length>0){e.items=e.items.sort(function(t,n){return t.address.lastName&&n.address.lastName&&t.address.lastName.toLowerCase()==n.address.lastName.toLowerCase()?t.address.address1.toLowerCase()==n.address.address1.toLowerCase()?0:t.address.address1.toLowerCase()<n.address.address1.toLowerCase()?-1:1:t.address.lastName&&n.address.lastName&&t.address.lastName.toLowerCase()<n.address.lastName.toLowerCase()?-1:1});for(var n=0;n<e.items.length;n++){e.items[n].isProfile=!0;var r=t.fetchCountryandStateName(e.items[n].address.country,e.items[n].address.state);e.items[n].address.displayCountryName=r.country,e.items[n].address.displayStateName=r.state?r.state:" ",t.profileAddresses().push(e.items[n])}t.profileOffset(e.offset+e.items.length),t.allAddresses.push(e.items),t.profileAddresses.valueHasMutated(),t.totalProfileAddresses(e.total),t.totalProfileAddresses()>t.profileOffset()||t.profileOffset(0)}if(o.profileType===s.PROFILE_TYPE_AGENT&&!t.user().isB2BUser()){var i=null;t.user().contactShippingAddress?i=t.user().contactShippingAddress.repositoryId:t.user().contactBillingAddress?i=t.user().contactBillingAddress.repositoryId:e.items.length>0&&!i&&(t.setDefaultShippingAddress(e.items[0]),t.loadDefaultAddressesSuccess(e.items[0]));if(i){var e={},u=s.END_POINT_GET_PROFILE_ADDRESS;o.request(u,e,t.loadDefaultAddressesSuccess.bind(t),t.fetchAddressesFailure.bind(t),t.user().id(),i)}}},fetchCountryandStateName:function(e,t){var n=this,r=null,i={};for(var s=0;s<n.countriesList().length;s++)if(e===n.countriesList()[s].countryCode){r=n.countriesList()[s],i.country=n.countriesList()[s].displayName;break}if(r.regions&&r.regions.length>0)for(var o=0;o<r.regions.length;o++)if(t===r.regions[o].abbreviation){i.state=r.regions[o].displayName;break}return i},populateSiteAndOrganization:function(){var e=this;e.contextManager&&(e.siteFilter(e.contextManager.getSelectedSite()),e.organizationFilter(e.contextManager.getCurrentOrganizationId()))},fetchAddressesFailure:function(e){var t=this;p.clearError(t.WIDGET_ID),p.clearSuccess(t.WIDGET_ID),e.status==s.HTTP_UNAUTHORIZED_ERROR?(t.user().handleSessionExpired(),(v.isPathEqualTo(t.links().profile.route)||v.isPathEqualTo(t.links().accountAddresses.route))&&v.doLogin(v.getPath(),t.homeRoute)):p.sendError(t.WIDGET_ID,e.message,!0)},findOrderHistory:function(e){var t=this;v.goTo("/pos_orderHistory/"+e)},clickOrderHistory:function(e,t,n){console.log("Entering clickOrderHistory()");var r=this;r.populateOrganizations(e),f.getInstance().setShopperProfileId(e.id);var i=r.user(),s=e.latestOrderSiteId;s===undefined&&s===null&&(s=i.contextData.global.site.siteInfo.repositoryId),f.getInstance().setSelectedSite(s),v.goTo("/occs-agent/pos_orderHistory/"+e.id),console.log("Exiting clickOrderHistory()")},clickAddressBook:function(){console.log("Entering clickAddressBook()");var e=this,t=e.user();console.log("widget--->"+JSON.stringify(e)),console.log("widget.user()"),console.log(t);var n=t.contextData.global.user.id;console.log("Profile Id"),console.log(n),n!==undefined&&n!==null&&f.getInstance().setShopperProfileId(n);var r=t.contextData.global.site.siteInfo.repositoryId;console.log("Site Id"),console.log(r),f.getInstance().setSelectedSite(r),v.goTo("/occs-agent/pos_addressBook/"+n),console.log("Exiting clickAddressBook()")},beforeAppear:function(e){var t=this;t.allAddresses([]),t.accountUniqueIdArray([]),t.isCreditHoldArray([]),t.isSlowPayArray([]),console.log("Entering - beforeAppear()"),f.getInstance().resetHeaders(),this.initCustomerSearchCriteria(),f.getInstance().clearAgentContextHeader(),a.removeFromStorage(s.LOCAL_STORAGE_ORGANIZATION_ID),a.removeFromStorage(s.LOCAL_STORAGE_AGENT_CONTEXT),a.removeFromStorage(s.LOCAL_STORAGE_SITE_ID),this.clearShopperContext(this.customerSearch.bind(this)),this.reset.bind(this),this.customerSearchViewModel.isSearchPerformed(!1);if(this.user().roles().length==0&&this.user().id()==""){this.user().isDelegatedAdmin(!0),this.loadCountries();return}this.loadCountries()},clearShopperContext:function(e){var n=d.getInstance();if(n.isExternalContext()){t.create(this.spinnerOptions);var r=n.populatePLGandCatalogData.bind(n,e);n.getOrderDynamicPropertiesWithDefaultValues(r)}else e&&e()},customerSearch:function(e){console.log("Entering - customerSearch()");var n=this,r=this;n.isCreditHoldArray([]),n.isSlowPayArray([]),n.allAddresses([]),n.accountUniqueIdArray([]);if(!r.isSearchEnabled()){t.destroy();return}t.create(this.spinnerOptions);var i={};c.isTextSearchEnabled()?i=r.getSearchCriteria():(i.q=r.getSearchQuery(),i.queryFormat=s.PARAM_QUERY_FORMAT_SCIM,i.limit=20,i.sort="id:desc",i.includeOrderDetails=!0),console.log("wwww",n.customerSearchViewModel),n.customerSearchViewModel.data(""),n.customerSearchViewModel.performSearch(0,i,this.createSpinnerCallBack.bind(this),this.destroySpinnersCallBack.bind(this),this.onSearchFailure.bind(this))},onSearchFailure:function(e){var t=n.t("ns.common:resources.returnCodeLabel"),r=e.message+t+":"+e.errorCode;p.sendError(e.code,r,!0)},destroySpinnersCallBack:function(){setTimeout(function(){if(m.customerSearchViewModel.data().length>0){console.log("123456789",m.customerSearchViewModel.data()[0].parentOrganization.repositoryId);for(var e=0;e<m.customerSearchViewModel.data().length;e++){var t=m.customerSearchViewModel.data()[e].parentOrganization.repositoryId;m.getUniqueId(t),console.log("1111",m.isSlowPayArray()),m.user().id(m.customerSearchViewModel.data()[e].id),m.loadProfileAddresses(),m.loadAddresses()}}},1e3)},getUniqueId:function(e){var n=this;i.ajax({url:"/ccadmin/v1/login?grant_type=client_credentials",headers:{Authorization:"Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyY2RhZWM0NS00ZWY2LTQ1Y2MtOWFjNC1mMWEwZGU5OWM3YjgiLCJpc3MiOiJhcHBsaWNhdGlvbkF1dGgiLCJleHAiOjE2NTE2NTMwOTMsImlhdCI6MTYyMDExNzA5M30=.ho4TAi3qAHWUKJOm7nmBtNcatIaSqKld+NV2X/YSZco=","Content-Type":"application/x-www-form-urlencoded"},method:"POST",processData:!1,contentType:!1,success:function(r){console.log(r),console.log(r.access_token),console.log("Front Acc Numberrrr : ",n.accountNumber()),i.ajax({url:"/ccadmin/v1/organizations/"+e,headers:{Authorization:"Bearer "+r.access_token,"Content-Type":"application/json"},method:"GET",dataType:"json",processData:!1,contentType:!1,cache:!1,data:JSON.stringify(),success:function(e){console.log("AJAX_",e.uniqueId),m.accountUniqueId(e.uniqueId),m.accountUniqueIdArray.push(e.uniqueId);var n=e.x_credit_hold;m.isCreditHoldArray.push(n),m.isSlowPayArray.push(e.x_slow_pay),t.destroy()},error:function(e){p.sendError(m.WIDGET_ID,"Failed to get UniqueId . Please try after some time",!1)}})},error:function(e){p.sendError(this.WIDGET_ID,"Unable to get inventory",!1)}})},createSpinnerCallBack:function(){t.create(this.spinnerOptions)},reset:function(){console.log("Inside reset");var e=this;e.accountNumber(""),e.businessName(""),e.phoneNumber(""),e.address1(""),e.city(""),e.state(""),e.postalCode(""),console.log("Inside reset"),i("#account-number").val(""),i("#business-name").val(""),i("#phone-number").val(""),i("#address1").val(""),i("#city").val(""),i("#state").val(""),i("#postalCode").val(""),this.customerSearchViewModel.isSearchPerformed(!1),this.isCreditHoldArray.push(""),this.isSlowPayArray.push(""),this.accountUniqueIdArray.push(""),this.allAddresses.push("")},initCustomerSearchCriteria:function(t,n,r,o,u,f,l,c){var h=this;h.lineOfBusiness=e.observableArray([]),h.accountNumber=e.observable(n||""),h.businessName=e.observable(r||""),h.phoneNumber=e.observable(o||""),h.isEditPhone=e.observable(!1),h.address1=e.observable(u||""),h.city=e.observable(f||""),h.state=e.observable(l||""),h.postalCode=e.observable(c||""),h.isEditPhone=e.observable(!1),h.phoneNumber.subscribe(function(e){i(".main-btn-left").prop("disabled",!1),i(".main-btn-right").prop("disabled",!1),e||(i(".main-btn-left").prop("disabled",!0),i(".main-btn-right").prop("disabled",!0),h.phoneNumber(h.phoneNumber().replace(/[^0-9]+/g,"")))}),h.accountNumber.subscribe(function(e){i(".main-btn-left").prop("disabled",!1),i(".main-btn-right").prop("disabled",!1),e||(i(".main-btn-left").prop("disabled",!0),i(".main-btn-right").prop("disabled",!0))}),h.businessName.subscribe(function(e){i(".main-btn-left").prop("disabled",!1),i(".main-btn-right").prop("disabled",!1),e||(i(".main-btn-left").prop("disabled",!0),i(".main-btn-right").prop("disabled",!0))}),h.phoneNumber.subscribe(function(e){i(".main-btn-left").prop("disabled",!1),i(".main-btn-right").prop("disabled",!1),e||(i(".main-btn-left").prop("disabled",!0),i(".main-btn-right").prop("disabled",!0))}),h.address1.subscribe(function(e){i(".main-btn-left").prop("disabled",!1),i(".main-btn-right").prop("disabled",!1),e||(i(".main-btn-left").prop("disabled",!0),i(".main-btn-right").prop("disabled",!0))}),h.city.subscribe(function(e){i(".main-btn-left").prop("disabled",!1),i(".main-btn-right").prop("disabled",!1),e||(i(".main-btn-left").prop("disabled",!0),i(".main-btn-right").prop("disabled",!0))}),h.state.subscribe(function(e){i(".main-btn-left").prop("disabled",!1),i(".main-btn-right").prop("disabled",!1),e||(i(".main-btn-left").prop("disabled",!0),i(".main-btn-right").prop("disabled",!0))}),h.postalCode.subscribe(function(e){i(".main-btn-left").prop("disabled",!1),i(".main-btn-right").prop("disabled",!1),e||(i(".main-btn-left").prop("disabled",!0),i(".main-btn-right").prop("disabled",!0))}),a.removeFromStorage(s.LOCAL_STORAGE_ORGANIZATION_ID),a.removeFromStorage(s.LOCAL_STORAGE_AGENT_CONTEXT)},handleAccountSearchValueUpdate:function(e,t){var n=this;t&&n.customerSearchViewModel.searchCriteria.account?n.elements["account-search"].accountSearchValue(n.customerSearchViewModel.searchCriteria.account):e=e?n.accountNameSelected([e]):n.accountNameSelected([])},getSearchCriteria:function(){var e=this,t={},n=["accountNumber",s.ORG_NAME,s.PROFILE_PHONE_NUMBER,"parentOrganization.active"],r=[e.accountNumber(),e.businessName(),e.phoneNumber(),!0,e.address1(),e.city(),e.state(),e.postalCode()],i=n.length;for(var o=0;o<i;o++)r[o]&&(t[n[o]]=r[o]);return t},formatSiteText:function(e){var t=this;return a.formatSiteText(e)},isSiteExists:function(e){return a.doesSiteExist(e.siteId)},getSearchQuery:function(){var e=this,t="",n="",r=[],i=["parentOrganization.uniqueId",s.SCIM_PARENT_ORGANIZATION_NAME,"parentOrganization.secondaryAddresses.phoneNumber","parentOrganization.active","parentOrganization.secondaryAddresses.address1","parentOrganization.secondaryAddresses.city","parentOrganization.secondaryAddresses.state","parentOrganization.secondaryAddresses.postalCode"],o=[e.accountNumber(),e.businessName(),e.phoneNumber(),!0,e.address1(),e.city(),e.state(),e.postalCode()];e.lineOfBusiness().length!==0&&(i.push("parentOrganization.x_line_of_business"),o.push(e.lineOfBusiness()));var u=i.length;for(var a=0;a<u;a++)o[a]&&(i[a]!=="parentOrganization.active"?t=i[a]+s.BLANK_SPACE+'sw "'+o[a]+'"':t=i[a]+" eq "+o[a],r.push(t));return n=e.andBuilder(r),n},getCurrentAdminProfile:function(e,t){var n=this,r={};console.log("getCurrentAdminProfile"),o.request("/ccagent/v1/adminProfiles/current",r,n.getCurrentAdminProfileSuccess.bind(n,e),n.getCurrentAdminProfileFailure.bind(n,t))},getCurrentAdminProfileSuccess:function(e,t){var n=this;for(var r=0;r<t.roles.length;r++)if(t.roles[r]!==null&&t.roles[r]!==""){var i={};isNaN(t.roles[r].repositoryId)||n.getSiteDescription(t.roles[r].repositoryId)}},getCurrentAdminProfileFailure:function(e,t){console.log("error: "+t.errors),p.sendError(ADMIN_PROFILE_CURRENT,t.message,!0),e&&e()},getSiteDescription:function(e){var t=this;i.ajax({url:"/ccadmin/v1/login?grant_type=client_credentials",headers:{Authorization:"Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyY2RhZWM0NS00ZWY2LTQ1Y2MtOWFjNC1mMWEwZGU5OWM3YjgiLCJpc3MiOiJhcHBsaWNhdGlvbkF1dGgiLCJleHAiOjE2NTE2NTMwOTMsImlhdCI6MTYyMDExNzA5M30=.ho4TAi3qAHWUKJOm7nmBtNcatIaSqKld+NV2X/YSZco=","Content-Type":"application/x-www-form-urlencoded"},method:"POST",success:function(n){i.ajax({url:"/ccadmin/v1/sites/"+e,headers:{Authorization:"Bearer "+n.access_token,"Content-Type":"application/json"},method:"GET",success:function(e){console.log("site description:::",JSON.stringify(e.description)),t.lineOfBusiness().includes(e.description)||t.lineOfBusiness.push(e.description)},error:function(e){p.sendError(this.WIDGET_ID,"Unable to get site response",!1)}})},error:function(e){p.sendError(this.WIDGET_ID,"Unable to get token",!1)}})},andBuilder:function(e){var t=this,n="";return e.forEach(function(e,t){t?n=n+s.BLANK_SPACE+s.AND_TEXT+s.BLANK_SPACE+e:n=e}),n},generateOrderText:function(e,t){var n=e;n.isCreateOrderEnabled(!1);if(l.activeSites().length==1){if(!n.isB2BUser(t))return t.hasIncompleteOrder?e.resources().completeOrderText:(n.isCreateOrderEnabled(!0),e.resources().createText);var r=n.getProfileOrganizationsCount(t,!1);if(r==1)return t.hasIncompleteOrder?e.resources().completeOrderText:(n.isCreateOrderEnabled(!0),e.resources().createText)}return e.resources().selectCartLink},getProfileOrganizationsCount:function(e,t){var n=e.parentOrganization&&(t||e.parentOrganization.active)?1:0,r=[];return e.secondaryOrganizations&&e.secondaryOrganizations.forEach(function(e){(t||e.active)&&r.push(e.name)}),n+=r?r.length:0,n},clickOrderDetails:function(e,t){var n=this;return n.contextManager.getInstance().setSelectedSite(e.latestOrderSiteId),n.contextManager.getInstance().setShopperProfileId(e.profileDetail?e.profileDetail.id:e.id),n.user().navigateToPage(this.links().AgentOrderDetails.route+"/"+t),!1},clickOrders:function(e){var t=this;return t.contextManager.getInstance().setShopperProfileId(e.profileDetail?e.profileDetail.id:e.id),t.user().navigateToPage(this.links().pos_orderHistory.route),!1},loadCheckoutPage:function(e){console.log("Entering - loadCheckoutPage()");var t=this,n=function(){var e=t.contextManager.getInstance().export();console.log("Context"),console.log(e);var n="/occs-agent/pos_new_cart".route;console.log("URL"),console.log(n),n=n+"?context="+encodeURIComponent(e),console.log("URL + context"),console.log(n),t.user().navigateToPage(n)};if(e.hasIncompleteOrder){var r={};r.profileId=e.id,t.contextManager.getInstance().setShopperProfileId(e.id),r.status="incomplete",o.request(s.ENDPOINT_ORDERS_SEARCH,r,function(e){e!==null&&e!==undefined?(t.contextManager.getInstance().setPriceListGroup(e.priceListGroup.id),v.goTo("/occs-agent/pos_new_cart")):(t.contextManager.getInstance().setPriceListGroup("in-Store_Price"),v.goTo("/occs-agent/pos_new_cart"))},function(e){p.sendError(t.widgetId(),e.message,!0)})}else v.goTo("/occs-agent/pos_new_cart");return console.log("Exiting - loadCheckoutPage()"),!1},clickProfileDetails:function(t){console.log("Entering clickProfileDetails()");var n=this;return console.log("Widget"),console.log(n),console.log("Profile Data"),console.log(e.utils.unwrapObservable(t)),console.log(e.utils.unwrapObservable(t.id)),f.getInstance().setShopperProfileId(t.id),t.parentOrganization&&t.parentOrganization.active?a.addToStorage(s.LOCAL_STORAGE_ORGANIZATION_ID,t.parentOrganization.repositoryId):a.addToStorage(s.LOCAL_STORAGE_ORGANIZATION_ID,null),v.goTo("/occs-agent/pos_customerInformation"),console.log("Exiting clickProfileDetails()"),!1},loadProfileAddresses:function(){var e=this;if(["",null,undefined].indexOf(e.accountNumber())==-1||["",null,undefined].indexOf(e.businessName())==-1||["",null,undefined].indexOf(e.phoneNumber())==-1||["",null,undefined].indexOf(e.address1())==-1||["",null,undefined].indexOf(e.city())==-1||["",null,undefined].indexOf(e.state())==-1||["",null,undefined].indexOf(e.postalCode())==-1){var t=s.END_POINT_LIST_PROFILE_ADDRESSES,n={};n[s.OFFSET]=e.profileOffset(),n[s.LIMIT]=e.limit(),console.log("Loading profile addresses..."),console.log(e.user().id()),o.profileType===s.PROFILE_TYPE_AGENT?o.request(t,n,e.loadProfileAddressSuccess.bind(e),e.fetchAddressesFailure.bind(e),e.user().id()):o.request(t,n,e.loadProfileAddressSuccess.bind(e),e.fetchAddressesFailure.bind(e)),console.log("22222",e.accountNumber()),e.allAddresses().length>0&&console.log("21111",e.allAddresses())}},loadAddresses:function(){console.log("Entering - loadAddresses()");var e=this;e.opDynamicProperty("view"),e.allAddresses.removeAll(),e.inheritedAddresses.removeAll(),e.profileAddresses.removeAll(),e.addresses.removeAll(),e.offset(0),e.secondaryAddresses.removeAll(),e.profileOffset(0),e.accountOffset(0),o.profileType===s.PROFILE_TYPE_AGENT?e.user().isB2BUser()||(e.loadProfileAddresses(),e.user().isB2BUser()&&(e.loadInheritedAddresses(),e.loadOrganizationAddresses())):(e.loadProfileAddresses(),e.loadInheritedAddresses(),e.loadOrganizationAddresses()),console.log("Loaddd111::",e.profileAddresses()),console.log("Exiting - loadAddresses()")},loadCountriesSuccess:function(e){var t=this;if(e.length>0)for(var n=0;n<e.length;n++)t.countriesList.push(e[n]);t.isEditMode(!1),t.populateSiteAndOrganization(),t.loadAddresses()},loadCountries:function(e){var t=this,n=s.ENDPOINT_COUNTRY_REGION_LIST_COUNTRIES,r={};r[s.OFFSET]=t.offset(),r.regions=!0,o.request(n,r,t.loadCountriesSuccess.bind(t),t.loadCountriesError.bind(t))},loadCountriesError:function(e){var t=this;p.clearError(t.WIDGET_ID),p.clearSuccess(t.WIDGET_ID),e.status==s.HTTP_UNAUTHORIZED_ERROR?(t.user().handleSessionExpired(),(v.isPathEqualTo(t.links().profile.route)||v.isPathEqualTo(t.links().accountAddresses.route))&&v.doLogin(v.getPath(),t.links().home.route)):p.sendError(t.WIDGET_ID,e.message,!0)},clickBrowseCatalog:function(e,t){var n=this;console.log("Entering clickBrowseCatalog()");var r=n.user().contextData.global.site.siteInfo.repositoryId;console.log("---------------------------  "+r),f.getInstance().setSelectedSite(r),n.populateOrganizations(e),t||f.getInstance().setPriceListGroup(n.user().priceListGroup.id());var i={};return i.profileId=e.id,i.status="incomplete",n.contextManager.getInstance().setShopperProfileId(e.id),o.request(s.ENDPOINT_ORDERS_SEARCH,i,function(e){e!==null&&e!==undefined?n.contextManager.getInstance().setPriceListGroup(e.priceListGroup.id):n.contextManager.getInstance().setPriceListGroup("in-Store_Price")},function(e){p.sendError(n.widgetId(),e.message,!0)}),n.browseCatalog(),console.log("Exiting clickBrowseCatalog()"),!1},browseCatalog:function(){var e=this;t.create(e.spinnerOptions);var n={};n[s.DEPTH]=s.DEPTH_MIN,n[s.CATALOG_MAXLEVEL_PARAM]=s.CATALOG_MAXLEVEL_1000,n[s.EXPAND_QUERY_PARAM]=s.EXPAND_CHILD_CATEGORIES,n[s.CATALOG]=this.user().catalogId(),o.request(s.ENDPOINT_COLLECTIONS_GET_COLLECTION,n,function(n){t.destroy(),e.user().navigateToPage(n.childCategories[0].route)},function(n){t.destroy(),p.sendError(e.WIDGET_ID,n.message,!0)},s.ROOT_CATEGORY_ID)},isB2BUser:function(e){var t=this;return e.profileType&&e.profileType=="b2b_user"},showOrderDetails:function(e,t,n){var r=this,i=this,s=l.activeSites(),o=s.length;f.getInstance().resetHeaders(),r.populateOrganizations(e),t||f.getInstance().setPriceListGroup(r.user().priceListGroup.id()),e&&e.profileType==="b2b_user"&&e.secondaryOrganizations.length===0&&(e.parentOrganization===null||!e.parentOrganization.active)?p.sendError(r.widgetId(),r.translate("noActiveAccountsAssociated"),!0):h.allOrganizations()&&h.allOrganizations().length<2?(r.contextManager.getInstance().setShopperProfileId(e.id),r.loadCheckoutPage(e),r.shopperContext.populatePLGandCatalogData(r.navigateToCheckoutPos.bind(r))):i.shopperContext&&i.shopperContext.dynamicProperties()&&i.shopperContext.dynamicProperties().length>0&&i.shopperContext.isContextNotNull()?(i.shopperContext.populatePLGandCatalogData(i.navigateToCheckout.bind(i)),console.log("TRUE")):(console.log("FALSE"),i.navigateToCheckoutPos())},navigateToCheckoutPos:function(){console.log("Entering - navigateToCheckoutPos()");var t=this,n=e.utils.unwrapObservable(t.profileId),r={};n!==undefined&&n!==null&&f.getInstance().setShopperProfileId(n),r.status="incomplete",r.profileId=n,o.request(ccConstants.ENDPOINT_ORDERS_SEARCH,r,function(e){e!==null&&e!==undefined?(f.getInstance().setPriceListGroup("defaultPriceGroup"),t.user().orderId(""),v.goTo("/occs-agent/pos_new_cart")):(f.getInstance().setPriceListGroup("defaultPriceGroup"),t.user().orderId(""),v.goTo("/occs-agent/pos_new_cart"))},function(e){p.sendError(t.widgetId(),e.message,!0)}),console.log("Exiting - navigateToCheckoutPos()")},showSavedOrderDetails:function(e,t,r){var s=this,o=l.activeSites(),u=o.length;f.getInstance().resetHeaders(),s.populateOrganizations(e),t||f.getInstance().setPriceListGroup(s.user().priceListGroup.id());if(e&&e.profileType==="b2b_user"&&e.secondaryOrganizations.length===0&&(e.parentOrganization===null||!e.parentOrganization.active))p.sendError(s.widgetId(),s.translate("noActiveAccountsAssociated"),!0);else{if(!(r===null||u===1&&h.allOrganizations()&&h.allOrganizations().length<2)){if(i(r+" .modal-header").children("span").length===0){var a=document.createElement("span");a.textContent=n.t("ns.agentcustomercartsdialog:resources.selectCart"),a.setAttribute("class","pull-left select-cart-header"),i(r+" .modal-header")[0].appendChild(a)}s.displayCustomerCarts(r,e,t);return}s.contextManager.getInstance().setShopperProfileId(e.id),s.loadCheckoutPage(e)}},displayCustomerCarts:function(t,n,r){var s=this,o=i(t),u=e.dataFor(o[0]),a=u.widgets()[0];f.getInstance().setShopperProfileId(n.id),a.profileDetail=n,a.incompleteOrders=r,a.customerCartsViewModel(a.instantiateCustomerCartsModel()),i(t).modal("toggle"),i(t).modal("show"),i(t).on("hide.bs.modal",function(){a.showIncompleteOrders(!1),i("body").removeClass("modal-open"),i(".modal-backdrop").remove()}.bind(s))},populateOrganizations:function(e){e.profileType&&e.profileType=="b2b_user"?h.populateOrganizations(e):(h.clearOrganizationDetails(),h.activeSites(l.activeSites()))},getOrganizationNamesSeparatedWith:function(e,t){var n=this,r=h.getOrganizations(e,!1);if(r.length===0)return"";if(r.length===1)return r[0].name;var i=[];return r.forEach(function(e){i.push(e.name)}),t?i.join(t):i.join()}}})